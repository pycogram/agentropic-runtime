<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agentropic - Ask the Agent</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', system-ui, sans-serif; background: #0a0a0f; color: #e0e0e0; height: 100vh; display: flex; flex-direction: column; }
  header { padding: 20px 24px; border-bottom: 1px solid #1a1a2e; }
  header h1 { font-size: 20px; font-weight: 600; color: #fff; }
  header h1 span { color: #6366f1; }
  header p { font-size: 13px; color: #666; margin-top: 4px; }
  #chat { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 16px; }
  .msg { max-width: 720px; padding: 12px 16px; border-radius: 12px; line-height: 1.5; font-size: 15px; }
  .msg.user { background: #1e1e3a; align-self: flex-end; border-bottom-right-radius: 4px; }
  .msg.agent { background: #111118; border: 1px solid #1a1a2e; align-self: flex-start; border-bottom-left-radius: 4px; }
  .msg .meta { font-size: 11px; color: #555; margin-top: 6px; }
  .msg .source { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
  .source.knowledge_base { background: #1a3a1a; color: #4ade80; }
  .source.llm { background: #3a2a1a; color: #fbbf24; }
  .source.none { background: #2a1a1a; color: #f87171; }
  #input-area { padding: 16px 24px; border-top: 1px solid #1a1a2e; display: flex; gap: 12px; }
  #question { flex: 1; padding: 12px 16px; background: #111118; border: 1px solid #1a1a2e; border-radius: 10px; color: #e0e0e0; font-size: 15px; outline: none; }
  #question:focus { border-color: #6366f1; }
  #question::placeholder { color: #444; }
  button { padding: 12px 24px; background: #6366f1; color: #fff; border: none; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; }
  button:hover { background: #5558e6; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  .typing { color: #666; font-style: italic; padding: 12px 16px; }
</style>
</head>
<body>
<header>
  <h1><span>Agentropic</span> CognitiveAgent</h1>
  <p>Ask questions about the framework. Answers from knowledge base or LLM fallback.</p>
</header>
<div id="chat"></div>
<div id="input-area">
  <input type="text" id="question" placeholder="Ask something..." autocomplete="off" />
  <button id="send" onclick="ask()">Ask</button>
</div>
<script>
const chat = document.getElementById('chat');
const input = document.getElementById('question');
const btn = document.getElementById('send');

input.addEventListener('keydown', e => { if (e.key === 'Enter' && !btn.disabled) ask(); });

async function ask() {
  const q = input.value.trim();
  if (!q) return;

  // Show user message
  chat.innerHTML += `<div class="msg user">${esc(q)}</div>`;
  input.value = '';
  btn.disabled = true;

  // Show typing
  const typing = document.createElement('div');
  typing.className = 'typing';
  typing.textContent = 'Thinking...';
  chat.appendChild(typing);
  chat.scrollTop = chat.scrollHeight;

  try {
    const res = await fetch('/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question: q })
    });
    const data = await res.json();
    typing.remove();

    chat.innerHTML += `<div class="msg agent">
      ${esc(data.answer)}
      <div class="meta">
        <span class="source ${data.source}">${data.source}</span>
        &middot; ${data.beliefs} beliefs
      </div>
    </div>`;
  } catch (err) {
    typing.remove();
    chat.innerHTML += `<div class="msg agent">Error: ${esc(err.message)}</div>`;
  }

  btn.disabled = false;
  chat.scrollTop = chat.scrollHeight;
  input.focus();
}

function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
</script>
</body>
</html>
